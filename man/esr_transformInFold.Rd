% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/train.R
\name{esr_transformInFold}
\alias{esr_transformInFold}
\title{Transform Counts In-Fold (Anti-leakage)}
\usage{
esr_transformInFold(
  split,
  counts,
  pheno,
  transform = "log1p-cpm",
  cpm_min = 1,
  cpm_min_samples = 4
)
}
\arguments{
\item{split}{An \code{rsample} split object (e.g., from \code{rsample::vfold_cv()}).}

\item{counts}{Matrix/data.frame of raw counts (genes x samples) for full dataset.}

\item{pheno}{Data.frame with sample metadata; must include \code{sample_id}.}

\item{transform}{Character scalar; transformation method. Defaults to "log1p-cpm".}

\item{cpm_min}{Minimum CPM threshold for gene filtering. Defaults to 1.}

\item{cpm_min_samples}{Minimum number of samples that must meet CPM threshold. Defaults to 4.}
}
\value{
A list with elements:
\describe{
\item{mat_t_train}{Transformed matrix (samples x genes) for training data}
\item{mat_t_test}{Transformed matrix (samples x genes) for test data}
\item{genes_keep}{Character vector of gene IDs kept after filtering}
\item{params}{List with preprocessing parameters used (for reproducibility)}
}
}
\description{
Applies transform/filter within CV fold, computing parameters from training data only
and applying them to test data to prevent data leakage.
}
\details{
This function enforces anti-leakage by:
\itemize{
\item Computing CPM filtering parameters from training data only
\item Applying training-based parameters to test data
\item Ensuring test data never influences preprocessing decisions
}
}
\examples{
\dontrun{
library(rsample)
data(gse201926_trainmini)
set.seed(123)
splits <- vfold_cv(gse201926_trainmini$pheno, v = 3)
result <- esr_transformInFold(
  splits$splits[[1]],
  gse201926_trainmini$counts,
  gse201926_trainmini$pheno
)
dim(result$mat_t_train)
dim(result$mat_t_test)
}
}
\references{
Ritchie, M. E., Phipson, B., Wu, D., Hu, Y., Law, C. W., Shi, W., & Smyth, G. K.
(2015). limma powers differential expression analyses for RNA-sequencing and
microarray studies. Nucleic Acids Research, 43(7), e47.
}
